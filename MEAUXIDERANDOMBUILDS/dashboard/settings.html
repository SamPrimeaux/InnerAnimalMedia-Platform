<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings | InnerAnimal Media OS</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        brand: {
                            orange: '#ff6b00',
                            red: '#dc2626',
                            dark: '#050507',
                            panel: '#0a0a0f',
                            surface: '#171717'
                        }
                    }
                }
            }
        }
    </script>

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Dashboard Container CSS -->
    <link rel="stylesheet" href="/shared/dashboard-container.css">

    <!-- Theme System CSS (if available) -->
    <link rel="stylesheet" href="/shared/themes/meaux-theme-library.css">

    <!-- Custom Styles -->
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: var(--dashboard-bg, #050507);
            color: var(--dashboard-text-primary, rgba(255, 255, 255, 0.95));
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
    </style>

</head>

<body>
    <!-- Dashboard Layout Container -->
    <div class="dashboard-layout">
        <!-- Sidebar -->
        <div id="sidebar-container"></div>

        <!-- Main Content Area -->
        <main class="dashboard-main">
            <!-- Dashboard Header -->
            <header class="dashboard-header" id="dashboard-header-container"></header>

            <!-- Dashboard Content -->
            <div class="dashboard-content custom-scrollbar">
                <div class="dashboard-content-inner">
                    <header
                        class="h-20 border-b border-white/10 bg-brand-panel/95 backdrop-blur-md flex items-center justify-between px-8 z-30">
                        <div class="flex items-center gap-4">
                            <h1 class="text-2xl font-bold text-white">Settings</h1>
                            <span class="text-xs text-zinc-500">Theme library & brand asset management</span>
                        </div>
                    </header>

                    <div class="flex-1 overflow-y-auto p-8 custom-scrollbar">
                        <div class="max-w-7xl mx-auto space-y-8">
                            <!-- Settings Tabs -->
                            <div class="bg-brand-panel border border-white/10 rounded-2xl p-2 flex gap-2">
                                <button onclick="settings.switchTab('integrations')" id="tab-integrations"
                                    class="flex-1 px-6 py-3 rounded-xl font-medium transition-all flex items-center justify-center gap-2 bg-brand-orange text-white">
                                    <i data-lucide="link" class="w-4 h-4"></i>
                                    Integrations
                                </button>
                                <button onclick="settings.switchTab('themes')" id="tab-themes"
                                    class="flex-1 px-6 py-3 rounded-xl font-medium transition-all flex items-center justify-center gap-2 bg-transparent text-zinc-400 hover:text-white hover:bg-white/5">
                                    <i data-lucide="palette" class="w-4 h-4"></i>
                                    Themes
                                </button>
                                <button onclick="settings.switchTab('preferences')" id="tab-preferences"
                                    class="flex-1 px-6 py-3 rounded-xl font-medium transition-all flex items-center justify-center gap-2 bg-transparent text-zinc-400 hover:text-white hover:bg-white/5">
                                    <i data-lucide="settings" class="w-4 h-4"></i>
                                    Preferences
                                </button>
                            </div>

                            <!-- Integrations Tab Content -->
                            <div id="integrations-tab" class="space-y-6">
                                <!-- Integration Status Dashboard -->
                                <div class="bg-brand-panel border border-white/10 rounded-2xl p-6">
                                    <div class="flex items-center justify-between mb-6">
                                        <div>
                                            <h3 class="text-lg font-bold text-white flex items-center gap-2">
                                                <i data-lucide="activity" class="w-5 h-5 text-brand-orange"></i>
                                                Integration Health
                                            </h3>
                                            <p class="text-sm text-zinc-400 mt-1">Overview of all your connected
                                                services</p>
                                        </div>
                                        <button onclick="settings.refreshIntegrationStatus()"
                                            class="px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-sm text-zinc-300 transition-colors flex items-center gap-2">
                                            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                            Refresh
                                        </button>
                                    </div>
                                    <div id="integration-status-summary"
                                        class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                        <!-- Status cards will be rendered here -->
                                    </div>
                                    <div id="integration-status-grid"
                                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        <!-- Integration cards will be rendered here -->
                                    </div>
                                </div>

                                <!-- Google Services -->
                                <div class="bg-brand-panel border border-white/10 rounded-2xl p-6"
                                    id="integration-google">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-red-500 flex items-center justify-center">
                                                <i data-lucide="mail" class="w-5 h-5 text-white"></i>
                                            </div>
                                            <div>
                                                <h3 class="text-lg font-bold text-white">Google Services</h3>
                                                <p class="text-sm text-zinc-400">Drive, Gemini, OAuth</p>
                                            </div>
                                        </div>
                                        <div id="google-status-badge"
                                            class="px-3 py-1 rounded-full text-xs font-medium bg-zinc-800 text-zinc-400">
                                            Checking...
                                        </div>
                                    </div>
                                    <div id="google-connection-details" class="space-y-4">
                                        <!-- Connection details will be rendered here -->
                                    </div>
                                    <div class="mt-4 flex gap-3">
                                        <button onclick="settings.connectGoogle()" id="google-connect-btn"
                                            class="px-4 py-2 bg-brand-orange hover:bg-orange-600 text-white rounded-lg font-medium transition-colors flex items-center gap-2">
                                            <i data-lucide="link" class="w-4 h-4"></i>
                                            Connect Google
                                        </button>
                                        <button onclick="settings.disconnectGoogle()" id="google-disconnect-btn"
                                            class="px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-zinc-300 transition-colors flex items-center gap-2 hidden">
                                            <i data-lucide="unlink" class="w-4 h-4"></i>
                                            Disconnect
                                        </button>
                                        <button onclick="settings.testGoogleConnection()" id="google-test-btn"
                                            class="px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-zinc-300 transition-colors flex items-center gap-2 hidden">
                                            <i data-lucide="test-tube" class="w-4 h-4"></i>
                                            Test Connection
                                        </button>
                                    </div>
                                </div>

                                <!-- GitHub -->
                                <div class="bg-brand-panel border border-white/10 rounded-2xl p-6"
                                    id="integration-github">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 rounded-lg bg-gray-800 flex items-center justify-center">
                                                <i data-lucide="github" class="w-5 h-5 text-white"></i>
                                            </div>
                                            <div>
                                                <h3 class="text-lg font-bold text-white">GitHub</h3>
                                                <p class="text-sm text-zinc-400">Optional - Connect your GitHub account
                                                </p>
                                            </div>
                                        </div>
                                        <div id="github-status-badge"
                                            class="px-3 py-1 rounded-full text-xs font-medium bg-zinc-800 text-zinc-400">
                                            Checking...
                                        </div>
                                    </div>
                                    <div class="mb-4 p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg">
                                        <p class="text-sm text-blue-300">
                                            <i data-lucide="info" class="w-4 h-4 inline mr-2"></i>
                                            GitHub integration is optional. Connect your personal GitHub account to use
                                            GitHub
                                            features within the platform.
                                        </p>
                                    </div>
                                    <div id="github-connection-details" class="space-y-4">
                                        <!-- Connection details will be rendered here -->
                                    </div>
                                    <div class="mt-4 flex gap-3">
                                        <button onclick="settings.connectGitHub()" id="github-connect-btn"
                                            class="px-4 py-2 bg-brand-orange hover:bg-orange-600 text-white rounded-lg font-medium transition-colors flex items-center gap-2">
                                            <i data-lucide="link" class="w-4 h-4"></i>
                                            Connect GitHub
                                        </button>
                                        <button onclick="settings.disconnectGitHub()" id="github-disconnect-btn"
                                            class="px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-zinc-300 transition-colors flex items-center gap-2 hidden">
                                            <i data-lucide="unlink" class="w-4 h-4"></i>
                                            Disconnect
                                        </button>
                                    </div>
                                </div>

                                <!-- Supabase -->
                                <div class="bg-brand-panel border border-white/10 rounded-2xl p-6"
                                    id="integration-supabase">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 rounded-lg bg-gradient-to-br from-green-500 to-emerald-500 flex items-center justify-center">
                                                <i data-lucide="database" class="w-5 h-5 text-white"></i>
                                            </div>
                                            <div>
                                                <h3 class="text-lg font-bold text-white">Supabase</h3>
                                                <p class="text-sm text-zinc-400">Connect your Supabase project</p>
                                            </div>
                                        </div>
                                        <div id="supabase-status-badge"
                                            class="px-3 py-1 rounded-full text-xs font-medium bg-zinc-800 text-zinc-400">
                                            Checking...
                                        </div>
                                    </div>
                                    <div id="supabase-connection-form" class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-white mb-2">Connection
                                                String</label>
                                            <input type="password" id="supabase-connection-string"
                                                placeholder="postgresql://..."
                                                class="w-full px-4 py-2.5 bg-black/40 border border-white/10 rounded-lg text-white placeholder-zinc-500 focus:outline-none focus:border-brand-orange focus:ring-2 focus:ring-brand-orange/20">
                                            <p class="text-xs text-zinc-500 mt-1">Your Supabase database connection
                                                string</p>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-white mb-2">Project ID
                                                (Optional)</label>
                                            <input type="text" id="supabase-project-id" placeholder="your-project-id"
                                                class="w-full px-4 py-2.5 bg-black/40 border border-white/10 rounded-lg text-white placeholder-zinc-500 focus:outline-none focus:border-brand-orange focus:ring-2 focus:ring-brand-orange/20">
                                        </div>
                                    </div>
                                    <div class="mt-4 flex gap-3">
                                        <button onclick="settings.connectSupabase()" id="supabase-connect-btn"
                                            class="px-4 py-2 bg-brand-orange hover:bg-orange-600 text-white rounded-lg font-medium transition-colors flex items-center gap-2">
                                            <i data-lucide="save" class="w-4 h-4"></i>
                                            Save Connection
                                        </button>
                                        <button onclick="settings.testSupabaseConnection()" id="supabase-test-btn"
                                            class="px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-zinc-300 transition-colors flex items-center gap-2 hidden">
                                            <i data-lucide="test-tube" class="w-4 h-4"></i>
                                            Test Connection
                                        </button>
                                    </div>
                                </div>

                                <!-- Cursor API -->
                                <div class="bg-brand-panel border border-white/10 rounded-2xl p-6"
                                    id="integration-cursor">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center">
                                                <i data-lucide="mouse-pointer-2" class="w-5 h-5 text-white"></i>
                                            </div>
                                            <div>
                                                <h3 class="text-lg font-bold text-white">Cursor API</h3>
                                                <p class="text-sm text-zinc-400">AI-powered code assistance</p>
                                            </div>
                                        </div>
                                        <div id="cursor-status-badge"
                                            class="px-3 py-1 rounded-full text-xs font-medium bg-zinc-800 text-zinc-400">
                                            Checking...
                                        </div>
                                    </div>
                                    <div id="cursor-connection-form" class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-white mb-2">Cursor API
                                                Key</label>
                                            <input type="password" id="cursor-api-key" placeholder="key_..."
                                                class="w-full px-4 py-2.5 bg-black/40 border border-white/10 rounded-lg text-white placeholder-zinc-500 focus:outline-none focus:border-brand-orange focus:ring-2 focus:ring-brand-orange/20">
                                            <p class="text-xs text-zinc-500 mt-1">Your Cursor API key for code
                                                generation</p>
                                        </div>
                                    </div>
                                    <div class="mt-4 flex gap-3">
                                        <button onclick="settings.connectCursor()" id="cursor-connect-btn"
                                            class="px-4 py-2 bg-brand-orange hover:bg-orange-600 text-white rounded-lg font-medium transition-colors flex items-center gap-2">
                                            <i data-lucide="save" class="w-4 h-4"></i>
                                            Save API Key
                                        </button>
                                        <button onclick="settings.testCursorConnection()" id="cursor-test-btn"
                                            class="px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-zinc-300 transition-colors flex items-center gap-2 hidden">
                                            <i data-lucide="test-tube" class="w-4 h-4"></i>
                                            Test Connection
                                        </button>
                                    </div>
                                </div>

                                <!-- Hyperdrive -->
                                <div class="bg-brand-panel border border-white/10 rounded-2xl p-6"
                                    id="integration-hyperdrive">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 rounded-lg bg-gradient-to-br from-orange-500 to-yellow-500 flex items-center justify-center">
                                                <i data-lucide="zap" class="w-5 h-5 text-white"></i>
                                            </div>
                                            <div>
                                                <h3 class="text-lg font-bold text-white">Hyperdrive</h3>
                                                <p class="text-sm text-zinc-400">Cloudflare Hyperdrive connection</p>
                                            </div>
                                        </div>
                                        <div id="hyperdrive-status-badge"
                                            class="px-3 py-1 rounded-full text-xs font-medium bg-zinc-800 text-zinc-400">
                                            Checking...
                                        </div>
                                    </div>
                                    <div id="hyperdrive-info" class="p-4 bg-zinc-800/50 rounded-lg">
                                        <p class="text-sm text-zinc-300">
                                            Hyperdrive is configured at the platform level. Connection status is managed
                                            automatically.
                                        </p>
                                    </div>
                                </div>

                                <!-- Cloudflare MCP -->
                                <div class="bg-brand-panel border border-white/10 rounded-2xl p-6" id="integration-mcp">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 rounded-lg bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center">
                                                <i data-lucide="server" class="w-5 h-5 text-white"></i>
                                            </div>
                                            <div>
                                                <h3 class="text-lg font-bold text-white">Cloudflare MCP</h3>
                                                <p class="text-sm text-zinc-400">Model Context Protocol servers</p>
                                            </div>
                                        </div>
                                        <div id="mcp-status-badge"
                                            class="px-3 py-1 rounded-full text-xs font-medium bg-zinc-800 text-zinc-400">
                                            Checking...
                                        </div>
                                    </div>
                                    <div id="mcp-sessions-info" class="space-y-4">
                                        <!-- MCP sessions will be rendered here -->
                                    </div>
                                    <div class="mt-4">
                                        <button onclick="settings.setupMCP()" id="mcp-setup-btn"
                                            class="px-4 py-2 bg-brand-orange hover:bg-orange-600 text-white rounded-lg font-medium transition-colors flex items-center gap-2">
                                            <i data-lucide="plus" class="w-4 h-4"></i>
                                            Setup MCP Server
                                        </button>
                                    </div>
                                </div>

                                <!-- External Apps -->
                                <div class="bg-brand-panel border border-white/10 rounded-2xl p-6"
                                    id="integration-external">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center gap-3">
                                            <div
                                                class="w-10 h-10 rounded-lg bg-gradient-to-br from-pink-500 to-rose-500 flex items-center justify-center">
                                                <i data-lucide="grid-3x3" class="w-5 h-5 text-white"></i>
                                            </div>
                                            <div>
                                                <h3 class="text-lg font-bold text-white">External Apps</h3>
                                                <p class="text-sm text-zinc-400">Claude, OpenAI, CloudConvert, and more
                                                </p>
                                            </div>
                                        </div>
                                        <div id="external-status-badge"
                                            class="px-3 py-1 rounded-full text-xs font-medium bg-zinc-800 text-zinc-400">
                                            Checking...
                                        </div>
                                    </div>
                                    <div id="external-apps-list" class="space-y-3">
                                        <!-- External apps will be rendered here -->
                                    </div>
                                    <div class="mt-4">
                                        <a href="/dashboard" onclick="window.quickConnect?.showSettings?.()"
                                            class="inline-flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-zinc-300 transition-colors">
                                            <i data-lucide="settings" class="w-4 h-4"></i>
                                            Manage in Quick-Connect
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <!-- Themes Tab Content -->
                            <div id="themes-tab" class="space-y-8 hidden">
                                <!-- Theme Mode Selector -->
                                <div class="bg-brand-panel border border-white/10 rounded-2xl p-6">
                                    <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                        <i data-lucide="monitor" class="w-5 h-5 text-brand-orange"></i>
                                        Theme Mode
                                    </h3>
                                    <div class="flex items-center gap-4">
                                        <button onclick="settings.setThemeMode('light')" id="mode-light"
                                            class="px-6 py-3 rounded-xl border-2 transition-all flex items-center gap-2 font-medium border-white/10 hover:border-white/20 bg-black/40 text-zinc-400 hover:text-white">
                                            <i data-lucide="sun" class="w-4 h-4"></i>
                                            Light
                                        </button>
                                        <button onclick="settings.setThemeMode('dark')" id="mode-dark"
                                            class="px-6 py-3 rounded-xl border-2 transition-all flex items-center gap-2 font-medium border-brand-orange bg-brand-orange/10 text-white">
                                            <i data-lucide="moon" class="w-4 h-4"></i>
                                            Dark
                                        </button>
                                        <button onclick="settings.setThemeMode('system')" id="mode-system"
                                            class="px-6 py-3 rounded-xl border-2 transition-all flex items-center gap-2 font-medium border-white/10 hover:border-white/20 bg-black/40 text-zinc-400 hover:text-white">
                                            <i data-lucide="monitor" class="w-4 h-4"></i>
                                            System
                                        </button>
                                    </div>
                                </div>

                                <!-- Brand Preset Themes -->
                                <div class="bg-brand-panel border border-white/10 rounded-2xl p-6">
                                    <div class="flex items-center justify-between mb-6">
                                        <h3 class="text-lg font-bold text-white flex items-center gap-2">
                                            <i data-lucide="palette" class="w-5 h-5 text-brand-orange"></i>
                                            Brand Preset Themes
                                        </h3>
                                        <button onclick="settings.showCreateTheme()"
                                            class="px-4 py-2 bg-brand-orange hover:bg-orange-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                                            <i data-lucide="plus" class="w-4 h-4"></i>
                                            Create Custom Theme
                                        </button>
                                    </div>
                                    <div id="themes-container"
                                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        <div class="text-zinc-500 text-center py-12 animate-pulse">
                                            <i data-lucide="loader" class="w-8 h-8 mx-auto mb-4 animate-spin"></i>
                                            <div>Loading themes...</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Brand Assets Library -->
                                <div class="bg-brand-panel border border-white/10 rounded-2xl p-6">
                                    <div class="flex items-center justify-between mb-6">
                                        <h3 class="text-lg font-bold text-white flex items-center gap-2">
                                            <i data-lucide="image" class="w-5 h-5 text-brand-orange"></i>
                                            Brand Asset Library
                                        </h3>
                                        <div class="flex items-center gap-3">
                                            <select id="asset-type-filter" onchange="settings.filterBrandAssets()"
                                                class="px-3 py-2 bg-black/40 border border-white/10 rounded-lg text-sm text-white focus:outline-none focus:border-brand-orange/50">
                                                <option value="all">All Types</option>
                                                <option value="logo">Logos</option>
                                                <option value="icon">Icons</option>
                                                <option value="image">Images</option>
                                                <option value="video">Videos</option>
                                                <option value="color">Colors</option>
                                            </select>
                                            <button onclick="settings.showUploadBrandAsset()"
                                                class="px-4 py-2 bg-brand-orange hover:bg-orange-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                                                <i data-lucide="upload" class="w-4 h-4"></i>
                                                Upload Asset
                                            </button>
                                        </div>
                                    </div>
                                    <div id="brand-assets-container"
                                        class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                                        <div class="text-zinc-500 text-center py-8 animate-pulse">
                                            <i data-lucide="loader" class="w-6 h-6 mx-auto mb-2 animate-spin"></i>
                                            <div class="text-xs">Loading assets...</div>
                                        </div>
                                    </div>
                                    <div id="brand-assets-empty" class="hidden text-center py-12">
                                        <i data-lucide="image-off" class="w-12 h-12 mx-auto text-zinc-700 mb-4"></i>
                                        <h4 class="text-lg font-semibold text-zinc-400 mb-2">No Brand Assets</h4>
                                        <p class="text-sm text-zinc-600 mb-6">Upload your first brand asset to get
                                            started</p>
                                        <button onclick="settings.showUploadBrandAsset()"
                                            class="px-6 py-3 bg-brand-orange hover:bg-orange-600 text-white rounded-lg font-medium transition-colors">
                                            Upload Asset
                                        </button>
                                    </div>
                                </div>

                                <!-- Theme Customization (Advanced) -->
                                <div class="bg-brand-panel border border-white/10 rounded-2xl p-6">
                                    <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2">
                                        <i data-lucide="sliders-horizontal" class="w-5 h-5 text-brand-orange"></i>
                                        Advanced Theme Customization
                                    </h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-zinc-300 mb-2">Primary Brand
                                                Color</label>
                                            <div class="flex items-center gap-3">
                                                <input type="color" id="primary-color" value="#ff6b00"
                                                    onchange="settings.updateThemePreview()"
                                                    class="w-16 h-12 rounded-lg border border-white/10 cursor-pointer">
                                                <input type="text" id="primary-color-hex" value="#ff6b00"
                                                    onchange="settings.updateThemePreview()"
                                                    class="flex-1 px-4 py-2 bg-black/40 border border-white/10 rounded-lg text-white font-mono text-sm focus:outline-none focus:border-brand-orange/50">
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-zinc-300 mb-2">Secondary Brand
                                                Color</label>
                                            <div class="flex items-center gap-3">
                                                <input type="color" id="secondary-color" value="#dc2626"
                                                    onchange="settings.updateThemePreview()"
                                                    class="w-16 h-12 rounded-lg border border-white/10 cursor-pointer">
                                                <input type="text" id="secondary-color-hex" value="#dc2626"
                                                    onchange="settings.updateThemePreview()"
                                                    class="flex-1 px-4 py-2 bg-black/40 border border-white/10 rounded-lg text-white font-mono text-sm focus:outline-none focus:border-brand-orange/50">
                                            </div>
                                        </div>
                                        <div class="pt-4 border-t border-white/10 flex items-center justify-end gap-3">
                                            <button onclick="settings.resetThemeColors()"
                                                class="px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg text-zinc-300 transition-colors">
                                                Reset
                                            </button>
                                            <button onclick="settings.saveThemeCustomization()"
                                                class="px-4 py-2 bg-brand-orange hover:bg-orange-600 text-white rounded-lg font-medium transition-colors">
                                                Save Custom Theme
                                            </button>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <!-- Preferences Tab Content -->
                            <div id="preferences-tab" class="space-y-8 hidden">
                                <!-- User Preferences -->
                                <div class="bg-brand-panel border border-white/10 rounded-2xl p-6">
                                    <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2">
                                        <i data-lucide="user" class="w-5 h-5 text-brand-orange"></i>
                                        User Preferences
                                    </h3>
                                    <div class="space-y-4">
                                        <div
                                            class="flex items-center justify-between p-4 bg-black/40 rounded-xl border border-white/10">
                                            <div>
                                                <div class="font-medium text-white">Email Notifications</div>
                                                <div class="text-sm text-zinc-500">Receive email updates and alerts
                                                </div>
                                            </div>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" id="email-notifications" class="sr-only peer"
                                                    checked>
                                                <div
                                                    class="w-11 h-6 bg-zinc-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand-orange">
                                                </div>
                                            </label>
                                        </div>
                                        <div
                                            class="flex items-center justify-between p-4 bg-black/40 rounded-xl border border-white/10">
                                            <div>
                                                <div class="font-medium text-white">Push Notifications</div>
                                                <div class="text-sm text-zinc-500">Browser push notifications</div>
                                            </div>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" id="push-notifications" class="sr-only peer">
                                                <div
                                                    class="w-11 h-6 bg-zinc-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand-orange">
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Mobile Menu Button (will be injected by sidebar) -->

    <!-- Shared Layout Scripts -->
    <script src="/shared/layout.js"></script>
    <script src="/shared/dashboard-layout.js"></script>

    <!-- Load Sidebar and Header -->
    <script>
        async function loadDashboardComponents() {
            // Load sidebar
            try {
                const sidebarRes = await fetch('/shared/sidebar.html');
                if (sidebarRes.ok) {
                    const sidebarHtml = await sidebarRes.text();
                    const sidebarContainer = document.getElementById('sidebar-container');
                    if (sidebarContainer) {
                        sidebarContainer.innerHTML = sidebarHtml;
                        // Reinitialize icons after sidebar loads
                        if (typeof lucide !== 'undefined') {
                            setTimeout(() => lucide.createIcons(), 100);
                        }
                    }
                }
            } catch (error) {
                console.error('Error loading sidebar:', error);
            }

            // Load header
            try {
                const headerRes = await fetch('/shared/header.html');
                if (headerRes.ok) {
                    const headerHtml = await headerRes.text();
                    const headerContainer = document.getElementById('dashboard-header-container');
                    if (headerContainer) {
                        headerContainer.innerHTML = headerHtml;
                        // Update page title
                        const pageTitle = document.getElementById('page-title');
                        if (pageTitle) {
                            pageTitle.textContent = 'Settings';
                        }
                        // Reinitialize icons
                        if (typeof lucide !== 'undefined') {
                            setTimeout(() => lucide.createIcons(), 100);
                        }
                    }
                }
            } catch (error) {
                console.error('Error loading header:', error);
            }
        }

        // Initialize on DOM ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadDashboardComponents);
        } else {
            loadDashboardComponents();
        }
    </script>

    <!-- Page-specific scripts -->
    <script>
        const API_BASE = window.location.origin;

        // Settings functionality
        const settings = {
            currentTab: 'integrations',

            // Tab switching
            switchTab(tabName) {
                this.currentTab = tabName;

                // Update tab buttons
                document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                    btn.classList.remove('bg-brand-orange', 'text-white');
                    btn.classList.add('bg-transparent', 'text-zinc-400');
                });
                const activeTab = document.getElementById(`tab-${tabName}`);
                if (activeTab) {
                    activeTab.classList.remove('bg-transparent', 'text-zinc-400');
                    activeTab.classList.add('bg-brand-orange', 'text-white');
                }

                // Show/hide tab content
                document.querySelectorAll('[id$="-tab"]').forEach(tab => {
                    tab.classList.add('hidden');
                });
                const activeTabContent = document.getElementById(`${tabName}-tab`);
                if (activeTabContent) {
                    activeTabContent.classList.remove('hidden');
                }

                // Load data for active tab
                if (tabName === 'integrations') {
                    this.refreshIntegrationStatus();
                } else if (tabName === 'themes') {
                    this.loadThemes();
                    this.loadBrandAssets();
                } else if (tabName === 'preferences') {
                    this.loadPreferences();
                }
            },

            // Integration Status
            async refreshIntegrationStatus() {
                try {
                    const response = await fetch(`${API_BASE}/api/integrations/status`);
                    const result = await response.json();

                    if (result.success && result.data) {
                        this.renderIntegrationStatus(result.data, result.summary);
                    }
                } catch (error) {
                    console.error('Error loading integration status:', error);
                }
            },

            renderIntegrationStatus(integrations, summary) {
                // Update summary cards
                const summaryEl = document.getElementById('integration-status-summary');
                if (summaryEl && summary) {
                    summaryEl.innerHTML = `
                        <div class="bg-emerald-500/10 border border-emerald-500/20 rounded-xl p-4">
                            <div class="text-2xl font-bold text-emerald-400">${summary.connected || 0}</div>
                            <div class="text-xs text-zinc-500 uppercase">Connected</div>
                        </div>
                        <div class="bg-zinc-500/10 border border-zinc-500/20 rounded-xl p-4">
                            <div class="text-2xl font-bold text-zinc-400">${summary.disconnected || 0}</div>
                            <div class="text-xs text-zinc-500 uppercase">Disconnected</div>
                        </div>
                        <div class="bg-blue-500/10 border border-blue-500/20 rounded-xl p-4">
                            <div class="text-2xl font-bold text-blue-400">${summary.total || 0}</div>
                            <div class="text-xs text-zinc-500 uppercase">Total</div>
                        </div>
                        <div class="bg-brand-orange/10 border border-brand-orange/20 rounded-xl p-4">
                            <div class="text-2xl font-bold text-brand-orange">${summary.health_percentage || 0}%</div>
                            <div class="text-xs text-zinc-500 uppercase">Health</div>
                        </div>
                    `;
                }

                // Update individual integration statuses
                if (integrations) {
                    // Google
                    if (integrations.google) {
                        this.updateIntegrationBadge('google', integrations.google);
                        this.updateIntegrationButtons('google', integrations.google);
                    }
                    // GitHub
                    if (integrations.github) {
                        this.updateIntegrationBadge('github', integrations.github);
                        this.updateIntegrationButtons('github', integrations.github);
                    }
                    // Supabase
                    if (integrations.supabase) {
                        this.updateIntegrationBadge('supabase', integrations.supabase);
                        this.updateIntegrationButtons('supabase', integrations.supabase);
                    }
                    // Cursor
                    if (integrations.cursor) {
                        this.updateIntegrationBadge('cursor', integrations.cursor);
                        this.updateIntegrationButtons('cursor', integrations.cursor);
                    }
                    // Hyperdrive
                    if (integrations.hyperdrive) {
                        this.updateIntegrationBadge('hyperdrive', integrations.hyperdrive);
                    }
                    // MCP
                    if (integrations.mcp) {
                        this.updateIntegrationBadge('mcp', integrations.mcp);
                    }
                    // External Apps
                    if (integrations.external_apps) {
                        this.renderExternalApps(integrations.external_apps);
                    }
                }
            },

            updateIntegrationBadge(service, status) {
                const badge = document.getElementById(`${service}-status-badge`);
                if (!badge) return;

                const statusMap = {
                    'connected': { text: 'Connected', class: 'bg-emerald-500/20 text-emerald-400 border-emerald-500/50' },
                    'pending': { text: 'Pending', class: 'bg-yellow-500/20 text-yellow-400 border-yellow-500/50' },
                    'error': { text: 'Error', class: 'bg-red-500/20 text-red-400 border-red-500/50' },
                    'disconnected': { text: 'Disconnected', class: 'bg-zinc-500/20 text-zinc-400 border-zinc-500/50' },
                    'not_configured': { text: 'Not Configured', class: 'bg-zinc-500/20 text-zinc-400 border-zinc-500/50' },
                    'not_setup': { text: 'Not Setup', class: 'bg-zinc-500/20 text-zinc-400 border-zinc-500/50' }
                };

                const statusInfo = statusMap[status?.status || 'disconnected'] || statusMap.disconnected;
                badge.textContent = statusInfo.text;
                badge.className = `px-3 py-1 rounded-full text-xs font-medium border ${statusInfo.class}`;
            },

            updateIntegrationButtons(service, status) {
                const connectBtn = document.getElementById(`${service}-connect-btn`);
                const disconnectBtn = document.getElementById(`${service}-disconnect-btn`);
                const testBtn = document.getElementById(`${service}-test-btn`);

                if (status?.connected) {
                    if (connectBtn) connectBtn.classList.add('hidden');
                    if (disconnectBtn) disconnectBtn.classList.remove('hidden');
                    if (testBtn) testBtn.classList.remove('hidden');
                } else {
                    if (connectBtn) connectBtn.classList.remove('hidden');
                    if (disconnectBtn) disconnectBtn.classList.add('hidden');
                    if (testBtn) testBtn.classList.add('hidden');
                }
            },

            renderExternalApps(externalApps) {
                const container = document.getElementById('external-apps-list');
                if (!container || !externalApps.apps || externalApps.apps.length === 0) return;

                container.innerHTML = externalApps.apps.map(app => `
                    <div class="flex items-center justify-between p-4 bg-black/40 rounded-xl border border-white/10">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-gray-500 to-gray-600 flex items-center justify-center">
                                <i data-lucide="grid-3x3" class="w-5 h-5 text-white"></i>
                            </div>
                            <div>
                                <div class="font-medium text-white">${app.app_name || app.app_id}</div>
                                <div class="text-xs text-zinc-500">${app.connection_status || 'disconnected'}</div>
                            </div>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-medium ${app.connection_status === 'connected' ? 'bg-emerald-500/20 text-emerald-400' : 'bg-zinc-500/20 text-zinc-400'}">
                            ${app.connection_status || 'disconnected'}
                        </span>
                    </div>
                `).join('');

                if (typeof lucide !== 'undefined') lucide.createIcons();
            },

            // Google OAuth
            connectGoogle() {
                window.location.href = `${API_BASE}/api/oauth/google/authorize?redirect_uri=${encodeURIComponent(window.location.href)}`;
            },

            disconnectGoogle() {
                // TODO: Implement disconnect
                alert('Disconnect Google functionality coming soon');
            },

            testGoogleConnection() {
                // TODO: Implement test
                alert('Test Google connection functionality coming soon');
            },

            // GitHub OAuth
            connectGitHub() {
                window.location.href = `${API_BASE}/api/oauth/github/authorize?redirect_uri=${encodeURIComponent(window.location.href)}`;
            },

            disconnectGitHub() {
                // TODO: Implement disconnect
                alert('Disconnect GitHub functionality coming soon');
            },

            // Supabase
            async connectSupabase() {
                const connectionString = document.getElementById('supabase-connection-string')?.value;
                const projectId = document.getElementById('supabase-project-id')?.value;

                if (!connectionString) {
                    alert('Please enter a connection string');
                    return;
                }

                try {
                    // TODO: Implement Supabase connection save
                    alert('Supabase connection save functionality coming soon');
                } catch (error) {
                    console.error('Error connecting Supabase:', error);
                    alert('Failed to save Supabase connection');
                }
            },

            testSupabaseConnection() {
                // TODO: Implement test
                alert('Test Supabase connection functionality coming soon');
            },

            // Cursor API
            async connectCursor() {
                const apiKey = document.getElementById('cursor-api-key')?.value;

                if (!apiKey) {
                    alert('Please enter a Cursor API key');
                    return;
                }

                try {
                    // TODO: Implement Cursor API key save
                    alert('Cursor API key save functionality coming soon');
                } catch (error) {
                    console.error('Error saving Cursor API key:', error);
                    alert('Failed to save Cursor API key');
                }
            },

            testCursorConnection() {
                // TODO: Implement test
                alert('Test Cursor connection functionality coming soon');
            },

            // MCP
            setupMCP() {
                alert('MCP setup functionality coming soon');
            },

            // Themes
            async loadThemes() {
                const container = document.getElementById('themes-container');
                if (!container) return;

                try {
                    const response = await fetch(`${API_BASE}/api/themes`);
                    if (!response.ok) {
                        throw new Error(`API returned ${response.status}`);
                    }
                    const result = await response.json();

                    // Handle response structure: { success: true, data: themes[] }
                    const themes = result.success && Array.isArray(result.data) ? result.data : [];
                    this.renderThemes(themes);
                } catch (error) {
                    console.error('Error loading themes:', error);
                    container.innerHTML = `
                        <div class="col-span-full text-center py-12 text-zinc-500">
                            <i data-lucide="alert-circle" class="w-12 h-12 mx-auto mb-4 text-red-500"></i>
                            <div class="font-medium mb-2 text-white">Error loading themes</div>
                            <div class="text-sm">${error.message || 'Failed to load themes'}</div>
                        </div>
                    `;
                    if (typeof lucide !== 'undefined') lucide.createIcons();
                }
            },

            renderThemes(themes) {
                const container = document.getElementById('themes-container');
                if (!container) return;

                // Always clear the loading state
                if (!Array.isArray(themes)) {
                    themes = [];
                }

                if (themes.length === 0) {
                    container.innerHTML = `
                        <div class="col-span-full text-center py-12 text-zinc-500">
                            <i data-lucide="palette" class="w-12 h-12 mx-auto mb-4 text-zinc-700"></i>
                            <div class="font-medium mb-2">No themes found</div>
                            <div class="text-sm">Themes will appear here once created</div>
                        </div>
                    `;
                    if (typeof lucide !== 'undefined') lucide.createIcons();
                    return;
                }

                container.innerHTML = themes.map(theme => {
                    const config = typeof theme.config === 'string' ? JSON.parse(theme.config) : (theme.config || {});
                    const colors = config.colors || {};
                    const primaryColor = colors.primary || '#ff6b00';

                    return `
                    <div class="bg-brand-surface border ${theme.is_active ? 'border-brand-orange/50' : 'border-white/10'} rounded-xl p-6 hover:border-white/20 transition-all">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <h4 class="font-bold text-white mb-1">${(theme.display_name || theme.name || 'Unnamed Theme').replace(/'/g, "&apos;")}</h4>
                                <p class="text-sm text-zinc-500">${(theme.name || '').replace(/'/g, "&apos;")}</p>
                            </div>
                            ${theme.is_active ? '<span class="px-2 py-1 rounded-full text-xs font-medium bg-emerald-500/20 text-emerald-400 border border-emerald-500/50">Active</span>' : ''}
                        </div>
                        ${theme.preview_image_url ? `<img src="${theme.preview_image_url}" alt="${theme.display_name || theme.name}" class="w-full h-32 object-cover rounded-lg mb-4">` : `<div class="w-full h-32 rounded-lg mb-4 flex items-center justify-center" style="background: linear-gradient(135deg, ${primaryColor}22, ${primaryColor}44); border: 1px solid ${primaryColor}33;">
                            <div class="flex gap-2">
                                <div class="w-8 h-8 rounded" style="background-color: ${primaryColor};"></div>
                                <div class="w-8 h-8 rounded bg-zinc-700"></div>
                                <div class="w-8 h-8 rounded bg-zinc-600"></div>
                            </div>
                        </div>`}
                        <button onclick="settings.activateTheme('${theme.id.replace(/'/g, "\\'")}')" class="w-full px-4 py-2 ${theme.is_active ? 'bg-emerald-600 hover:bg-emerald-700' : 'bg-brand-orange hover:bg-orange-600'} text-white rounded-lg text-sm font-medium transition-colors">
                            ${theme.is_active ? ' Active' : 'Activate'}
                        </button>
                    </div>
                `;
                }).join('');

                if (typeof lucide !== 'undefined') lucide.createIcons();
            },

            async activateTheme(themeId) {
                try {
                    const response = await fetch(`${API_BASE}/api/themes`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ theme_id: themeId })
                    });

                    const data = await response.json();
                    if (data.success) {
                        await this.loadThemes();
                        // Show success notification (non-blocking)
                        const notification = document.createElement('div');
                        notification.className = 'fixed top-4 right-4 bg-emerald-600 text-white px-4 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2';
                        notification.innerHTML = '<i data-lucide="check-circle" class="w-5 h-5"></i><span>Theme activated</span>';
                        document.body.appendChild(notification);
                        if (typeof lucide !== 'undefined') lucide.createIcons();
                        setTimeout(() => notification.remove(), 3000);
                    } else {
                        throw new Error(data.error || 'Failed to activate theme');
                    }
                } catch (error) {
                    console.error('Error activating theme:', error);
                    alert(`Failed to activate theme: ${error.message}`);
                }
            },

            setThemeMode(mode) {
                document.querySelectorAll('[id^="mode-"]').forEach(btn => {
                    btn.classList.remove('border-brand-orange', 'bg-brand-orange/10', 'text-white');
                    btn.classList.add('border-white/10', 'bg-black/40', 'text-zinc-400');
                });

                const activeBtn = document.getElementById(`mode-${mode}`);
                if (activeBtn) {
                    activeBtn.classList.remove('border-white/10', 'bg-black/40', 'text-zinc-400');
                    activeBtn.classList.add('border-brand-orange', 'bg-brand-orange/10', 'text-white');
                }

                // Save preference
                localStorage.setItem('theme-mode', mode);

                // Apply theme mode (could trigger theme reload)
                document.documentElement.setAttribute('data-theme-mode', mode);
            },

            showCreateTheme() {
                // TODO: Open theme creation modal
                // For now, just log that it was clicked
                console.log('Create theme clicked - modal coming soon');
            },

            // Brand Assets
            async loadBrandAssets() {
                try {
                    // TODO: Implement brand assets API
                    const container = document.getElementById('brand-assets-container');
                    if (container) {
                        container.innerHTML = `
                            <div class="col-span-full text-center py-12 text-zinc-500">
                                <i data-lucide="image" class="w-12 h-12 mx-auto mb-4 text-zinc-700"></i>
                                <div class="font-medium mb-2">No brand assets</div>
                                <div class="text-sm">Upload your first brand asset</div>
                            </div>
                        `;
                        if (typeof lucide !== 'undefined') lucide.createIcons();
                    }
                } catch (error) {
                    console.error('Error loading brand assets:', error);
                }
            },

            filterBrandAssets() {
                // TODO: Implement filtering
            },

            showUploadBrandAsset() {
                alert('Upload brand asset functionality coming soon');
            },

            // Theme Customization
            updateThemePreview() {
                const primaryColor = document.getElementById('primary-color')?.value;
                const secondaryColor = document.getElementById('secondary-color')?.value;

                if (primaryColor) {
                    document.getElementById('primary-color-hex').value = primaryColor;
                }
                if (secondaryColor) {
                    document.getElementById('secondary-color-hex').value = secondaryColor;
                }
            },

            resetThemeColors() {
                document.getElementById('primary-color').value = '#ff6b00';
                document.getElementById('primary-color-hex').value = '#ff6b00';
                document.getElementById('secondary-color').value = '#dc2626';
                document.getElementById('secondary-color-hex').value = '#dc2626';
            },

            saveThemeCustomization() {
                alert('Save theme customization functionality coming soon');
            },

            // Preferences
            async loadPreferences() {
                try {
                    // Get user ID from session/localStorage or use default
                    const userId = 'current-user'; // TODO: Get from auth
                    const response = await fetch(`${API_BASE}/api/users/${userId}/preferences`);
                    const data = await response.json();

                    if (data.success && data.data) {
                        const prefs = data.data;
                        if (prefs.email_notifications !== undefined) {
                            document.getElementById('email-notifications').checked = prefs.email_notifications;
                        }
                        if (prefs.push_notifications !== undefined) {
                            document.getElementById('push-notifications').checked = prefs.push_notifications;
                        }
                    }
                } catch (error) {
                    console.error('Error loading preferences:', error);
                }
            },

            async savePreferences() {
                try {
                    const userId = 'current-user'; // TODO: Get from auth
                    const prefs = {
                        email_notifications: document.getElementById('email-notifications')?.checked || false,
                        push_notifications: document.getElementById('push-notifications')?.checked || false
                    };

                    const response = await fetch(`${API_BASE}/api/users/${userId}/preferences`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(prefs)
                    });

                    const data = await response.json();
                    if (data.success) {
                        alert('Preferences saved successfully!');
                    }
                } catch (error) {
                    console.error('Error saving preferences:', error);
                    alert('Failed to save preferences');
                }
            }
        };

        // Make settings available globally
        window.settings = settings;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Load initial tab
            settings.switchTab('integrations');

            // Load theme mode preference
            const savedMode = localStorage.getItem('theme-mode') || 'dark';
            settings.setThemeMode(savedMode);

            // Add preference save listeners
            document.getElementById('email-notifications')?.addEventListener('change', () => {
                settings.savePreferences();
            });
            document.getElementById('push-notifications')?.addEventListener('change', () => {
                settings.savePreferences();
            });

            // Reinitialize icons
            if (typeof lucide !== 'undefined') {
                setTimeout(() => lucide.createIcons(), 500);
            }
        });
    </script>

</body>

</html>