<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MeauxMarkets - Wallet</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0e27;
            color: #ffffff;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .header {
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #0f1629;
            border-bottom: 1px solid #1a2332;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: #3b82f6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .section {
            padding: 20px 16px;
        }

        .balance-card {
            background: linear-gradient(135deg, #1a2332 0%, #243447 100%);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid #243447;
        }

        .balance-label {
            color: #94a3b8;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .balance-amount {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .balance-change {
            font-size: 14px;
            font-weight: 600;
        }

        .positive {
            color: #10b981;
        }

        .negative {
            color: #ef4444;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: #1a2332;
            border-radius: 12px;
            padding: 16px;
            border: 1px solid #243447;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 12px;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
        }

        .nav-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #0f1629;
            border-top: 1px solid #1a2332;
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: #64748b;
            text-decoration: none;
            font-size: 12px;
        }

        .nav-item.active {
            color: #3b82f6;
        }

        .nav-item svg {
            width: 24px;
            height: 24px;
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="logo">
            <div class="logo-icon">M</div>
            <span>MeauxAccess</span>
        </div>
    </div>

    <div class="section">
        <h1 style="font-size: 28px; font-weight: 700; margin-bottom: 20px;">Wallet</h1>

        <div class="balance-card">
            <div class="balance-label">Total Portfolio Value</div>
            <div class="balance-amount" id="totalValue">$0.00</div>
            <div class="balance-change positive" id="totalChange">+0.00%</div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Cash Balance</div>
                <div class="stat-value" id="cashBalance">$100,000.00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Invested</div>
                <div class="stat-value" id="invested">$0.00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Return</div>
                <div class="stat-value positive" id="totalReturn">+0.00%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Positions</div>
                <div class="stat-value" id="positionsCount">0</div>
            </div>
        </div>

        <h2 style="font-size: 20px; font-weight: 600; margin-bottom: 16px;">Positions</h2>
        <div id="positions"></div>
    </div>

    <nav class="nav-bottom">
        <a href="/markets" class="nav-item">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M3 3v18h18" stroke-width="2" stroke-linecap="round" />
                <path d="M7 12l4-4 4 4 6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span>Markets</span>
        </a>
        <a href="/markets/wallet" class="nav-item active">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <rect x="1" y="4" width="22" height="16" rx="2" ry="2" stroke-width="2" />
                <line x1="1" y1="10" x2="23" y2="10" stroke-width="2" />
            </svg>
            <span>Wallet</span>
        </a>
        <a href="/markets/paper" class="nav-item">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M12 2L2 7l10 5 10-5-10-5z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M2 17l10 5 10-5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M2 12l10 5 10-5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span>Paper: Trade</span>
        </a>
        <a href="/markets/journal" class="nav-item">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
            <span>Journal</span>
        </a>
        <a href="/markets/tutor" class="nav-item">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                    d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span>Tutor AI</span>
        </a>
    </nav>

    <script>
        async function loadPositions() {
            try {
                const res = await fetch('/api/markets/paper/positions');
                const data = await res.json();
                if (data.ok && data.positions) {
                    const container = document.getElementById('positions');
                    container.innerHTML = '';

                    let totalValue = 100000; // Starting cash
                    let totalCost = 0;

                    if (data.positions.length === 0) {
                        container.innerHTML = '<div style="text-align: center; color: #94a3b8; padding: 40px;">No positions yet. Start trading to see your positions here.</div>';
                        return;
                    }

                    data.positions.forEach(pos => {
                        const value = pos.qty * pos.avg;
                        totalValue += value;
                        totalCost += pos.cost;

                        const item = document.createElement('div');
                        item.style.cssText = 'background: #1a2332; border-radius: 12px; padding: 16px; margin-bottom: 12px; border: 1px solid #243447;';
                        item.innerHTML = `
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 600; font-size: 18px;">${pos.symbol}</div>
                  <div style="color: #94a3b8; font-size: 14px;">${pos.qty} shares @ $${pos.avg.toFixed(2)}</div>
                </div>
                <div style="text-align: right;">
                  <div style="font-weight: 600;">$${value.toFixed(2)}</div>
                  <div style="color: #94a3b8; font-size: 12px;">${pos.qty > 0 ? 'Long' : 'Short'}</div>
                </div>
              </div>
            `;
                        container.appendChild(item);
                    });

                    // Update totals
                    document.getElementById('invested').textContent = `$${Math.abs(totalCost).toFixed(2)}`;
                    document.getElementById('totalValue').textContent = `$${totalValue.toFixed(2)}`;
                    document.getElementById('positionsCount').textContent = data.positions.length;

                    const returnPct = totalCost !== 0 ? ((totalValue - 100000) / 100000 * 100) : 0;
                    document.getElementById('totalReturn').textContent = `${returnPct >= 0 ? '+' : ''}${returnPct.toFixed(2)}%`;
                    document.getElementById('totalReturn').className = returnPct >= 0 ? 'stat-value positive' : 'stat-value negative';
                    document.getElementById('totalChange').textContent = `${returnPct >= 0 ? '+' : ''}${returnPct.toFixed(2)}%`;
                    document.getElementById('totalChange').className = returnPct >= 0 ? 'balance-change positive' : 'balance-change negative';
                }
            } catch (err) {
                console.error('Failed to load positions:', err);
            }
        }
        loadPositions();
    </script>
</body>

</html>